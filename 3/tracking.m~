
video_frame_dir = 'pingpong';
fullfile(pwd, video_frame_dir, '*.jpg')
image_names = dir(fullfile(pwd, video_frame_dir, '*.jpeg'));
images = cell(length(image_names),1);
for k = 1:length(image_names)
  image_name = fullfile(pwd, video_frame_dir, image_names(k).name);
  images{k} = imread(image_name);
end

%{
c = containers.Map
c('foo') = 1
c(' not a var name ') = 2
keys(c)
values(c)
%}

blocksize = 5
[H, r, c] = harris_corner_detector(images{1});
size(images{1})
rectangle = zeroes(3, 3, 3);
rectangle(:, :, 1) = 255;
for ii = 1:length(images) - 1
    Vy_Vx = lucas_kanade(images{ii}, images{ii + 1}, blocksize);
    for jj = 1:length(r)
        %images{ii} = insertShape(images{ii}, 'rectangle', [r(jj), c(jj)]);
        images{ii}(r(jj)-1:r(jj)+1, c(jj)-1:c(jj)+1, :) = [255 0 0];
    end
end

outputVideo = VideoWriter(fullfile(pwd,'feature_tracking_demo.avi'));
outputVideo.FrameRate = 10;
open(outputVideo);
for ii = 1:length(images)
   writeVideo(outputVideo, uint8(images{ii}));
end

close(outputVideo)
